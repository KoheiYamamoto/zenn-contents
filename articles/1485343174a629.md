---
title: "Xamarin.Forms (Android) ã§ Map ã‚’ä½¿ã£ã¦ç¾åœ¨åœ°ã‚’å–å¾—ã—ã€ãƒ”ãƒ³ã‚’è¿½åŠ ã™ã‚‹"
emoji: "ğŸ˜½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Xamarin", "Xamarin.Forms.Map", "Map", "GoogleMap"]
published: false
---

# ã¯ã˜ã‚ã«

ä»¥ä¸‹ã®ã‚‚ã®ã‚’æº–å‚™
- Visual Studio 2022
- Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

[Notification Hubs ã®æ™‚](https://zenn.dev/moimoi_kohei/articles/cbef4b3929b33d) ã¨åŒæ§˜ã€Android ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã§é€²ã‚ã‚‹ã“ã¨ã«ã—ãŸã€‚

# å…¨ä½“åƒ
Xamarin.Androidã§åœ°å›³ã‚’ä½¿ã†éš›ã€[Xamarin.Forms.Map](https://docs.microsoft.com/ja-jp/xamarin/xamarin-forms/user-interface/map/) ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¨ã—ã¦åˆ¶å¾¡ã‚’è¡Œã„ã€åœ°å›³è‡ªä½“ã¯ Google Map ã® API ã‚’ä½¿ã£ã¦è¡¨ç¤ºã™ã‚‹äº‹ã«ãªã‚‹ã¿ãŸã„ï¼ˆãŠãã‚‰ãï¼‰ã€‚

# å®Ÿè£…
1. ãƒãƒƒãƒ—ã®è¿½åŠ 
2. ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ç¾åœ¨åœ°ã‚’å–å¾—
3. ãƒãƒƒãƒ—ä¸Šã«ãƒ”ãƒ³ã‚’è¿½åŠ 

## ãƒãƒƒãƒ—ã®è¿½åŠ 
ã“ã¡ã‚‰ã®å…¬å¼Docsã‚’å‚è€ƒã«é€²ã‚ã‚‹ã€‚https://docs.microsoft.com/ja-jp/xamarin/xamarin-forms/user-interface/map/setup
### Nu Get
å…±æœ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€å…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- Xamarin.Forms.Maps (ver. 5.0.0.2196) 

### MainAvctivity.csã«è¿½åŠ 
```
Xamarin.Essentials.Platform.Init(this, savedInstanceState);
global::Xamarin.Forms.Forms.Init(this, savedInstanceState);
Xamarin.FormsMaps.Init(this, savedInstanceState); // â† ã“ã®è¡Œã‚’è¿½åŠ 
LoadApplication(new App());
```

### Google Map API ã‚­ãƒ¼ã‚’å–å¾—
ã“ã¡ã‚‰ã®å…¬å¼Docsã‚’å‚è€ƒã«é€²ã‚ã¦ã„ãã€‚https://docs.microsoft.com/ja-jp/xamarin/android/platform/maps-and-location/maps/obtaining-a-google-maps-api-key?tabs=windows

### AndroidManifest.xml ã® ã«ä»¥ä¸‹ã‚’è¿½åŠ 

```<application>``` ãƒ–ãƒ­ãƒƒã‚¯å†…ã«ä»¥ä¸‹ã‚’è¿½åŠ 
```
<meta-data android:name="com.google.android.geo.API_KEY" android:value="PASTE-YOUR-API-KEY-HERE" />
<meta-data android:name="com.google.android.gms.version" android:value="@integer/google_play_services_version" />
<uses-library android:name="org.apache.http.legacy" android:required="false" />
```

ä»¥ä¸‹ã® ```<uses-permission>``` ã‚‚è¿½åŠ 
```
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />

<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
```

### MainPage.xaml ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£
```<maps:Map x:Name="map>```ã‚’æŒ¿å…¥ã—ã¦èµ·å‹•ã™ã‚‹ã“ã¨ã§åœ°å›³ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚```xmlns:maps="clr-namespace:Xamarin.Forms.Maps;assembly=Xamarin.Forms.Maps"```ã‚’è¿½åŠ ã—ã¦ãŠãã“ã¨ã‚‚å¿˜ã‚Œã¦ã¯ã„ã‘ãªã„ã€‚
```
<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:maps="clr-namespace:Xamarin.Forms.Maps;assembly=Xamarin.Forms.Maps"
             x:Class="PushDemoAndroid.MainPage">

    <StackLayout>
        <Frame BackgroundColor="#2196F3" Padding="24" CornerRadius="0">
            <Label Text="Welcome to Xamarin.Forms!" HorizontalTextAlignment="Center" TextColor="White" FontSize="36"/>
        </Frame>
        <maps:Map x:Name="map" />
    </StackLayout>

</ContentPage>
```

## ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ç¾åœ¨åœ°ã‚’å–å¾—

ä¸Šã®ã‚³ãƒ¼ãƒ‰ã®ä¸­ã§ã€``` <Button Text="ç¾åœ¨åœ°å‘¨è¾ºã‚’æ¤œç´¢"  HorizontalOptions="Start" Clicked="CurrentLocationButton_Clicked"/>``` ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€```<CurrentLocationButton_Clicked>```ã®é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚

### MainPage.xaml ã«ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
``` <StackLayout> ``` ãƒ–ãƒ­ãƒƒã‚¯ã®ä¸­ã«ä»¥ä¸‹ã‚’è¿½è¨˜ã™ã‚‹ã€‚

```
<Button Text="ç¾åœ¨åœ°å‘¨è¾ºã‚’æ¤œç´¢"  HorizontalOptions="Start" Clicked="CurrentLocationButton_Clicked"/>
        <Label x:Name="GPSlabel" HorizontalOptions="Center" TextColor="Black"/>
```

### MainPage.xaml.cs ã«ã¦é–¢æ•°ã‚’å®£è¨€

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Xamarin.Forms;
using Xamarin.Essentials;
using Xamarin.Forms.Maps;
â€¦
private async void CurrentLocationButton_Clicked(object sender, EventArgs e)
{
    try
    {
        var request = new GeolocationRequest(GeolocationAccuracy.Medium);
        var location = await Geolocation.GetLocationAsync(request);

        if (location != null)
        {
            GPSlabel.Text = $"{location.Latitude},{location.Longitude}";
            // enable IsShowingUser (built-in button to get the current location)
            map.IsShowingUser = true;
            // move the map to current location
            Position position = new Position(Convert.ToDouble(location.Latitude), Convert.ToDouble(location.Longitude));
            MapSpan mapSpan = new MapSpan(position, 0.01, 0.01);
            map.MoveToRegion(mapSpan);
        }
    }
    catch (Exception)
    {

    }
}
```

ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã¨ã€ã€Œç¾åœ¨åœ°ã®å–å¾—è¨±å¯ã€ã¨ã„ã†ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒå‡ºã‚‹ã®ã§ã€ç¢ºèªã—ã¦è¨±å¯ã™ã‚‹ã€‚ãã®å¾Œã€```<Label x:Name="GPSlabel" HorizontalOptions="Center" TextColor="Black"/>```ã«ç·¯åº¦çµŒåº¦ãŒç”»é¢ä¸Šã§åæ˜ ã•ã‚Œã€ç¾åœ¨åœ°ã«ç”»é¢ãŒç§»å‹•ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã‚‹ã€‚ã‚‚ã—ã‚‚ã€ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã„ã‚Œã°ã€ç¾åœ¨åœ°ã¯ [Googleplex](https://ja.wikipedia.org/wiki/Googleplex) ã«ã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ã¯ãšã ã€‚

## ãƒãƒƒãƒ—ä¸Šã«ãƒ”ãƒ³ã‚’è¿½åŠ 

MainPage.xaml.csã®ä¸­ã®```map.MoveToRegion(mapSpan);```ã®å¾Œã«ã€ä»¥ä¸‹ã‚’è¿½åŠ 

```
map.MoveToRegion(mapSpan);
// Add Pin
AddPin();
```

### MainPage.xaml.cs ã«ã¦é–¢æ•°ã‚’å®Ÿè£…

ä»Šå›ã¯ãƒ”ãƒ³ã‚’ç«‹ã¦ã‚Œã‚‹ã‹ã©ã†ã‹ã®ãŠè©¦ã—ãªã®ã§ã€ãƒ”ãƒ³ã‚’ç«‹ã¦ã‚‹éš›ã«å¿…è¦ãªæƒ…å ±ã‚’é–¢æ•°å†…ã§è¨­å®šã—ã¦ã„ã‚‹ãŒã€å½“ãŸã‚Šå‰ã ãŒã“ã®ã‚ãŸã‚Šã®æƒ…å ±ã¯å¼•æ•°æ¸¡ã—ãŒæœ›ã¾ã—ã„ã€‚
```
private void AddPin()
{
    Pin pin = new Pin
    {
        Label = "Santa Cruz",
        Address = "The city with a boardwalk",
        Type = PinType.Place,
        Position = new Position(37.42056167283825, -122.08411115979173)
    };
    map.Pins.Add(pin);
}

```

è¿½åŠ ã—ãŸå¾Œã«ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æŒ‡å®šã—ãŸå ´æ‰€ã«ãƒ”ãƒ³ãŒç«‹ã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã‚‹ã€‚è¿½åŠ ã—ãŸãƒ”ãƒ³ã¯```map.clear()```ã«ã‚ˆã‚Šå‰Šé™¤ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ãƒ‡ãƒ¢å‹•ç”»ã¯æ¬¡å·ã«ã¦ã€ã¾ã¨ã‚ã¦æ²è¼‰ã™ã‚‹äºˆå®šã€‚
ã¡ãªã¿ã«ã€ã‚‚ã—ã€ãƒ”ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’å·¥å¤«ã—ãŸã„ã®ã§ã‚ã‚Œã°ã€[ã“ã¡ã‚‰](https://docs.microsoft.com/ja-jp/xamarin/xamarin-forms/app-fundamentals/custom-renderer/map-pin) ã®å…¬å¼Docsã‚‚å‚è€ƒã«ãªã‚‹ã‹ã¨æ€ã†ãŒã€ä»Šå›ã¯å‰²æ„›ã€‚