---
title: "Xamarin.Forms (Android) ã« Azure Notification Hubs ã‹ã‚‰ã‚¿ã‚°ã‚’æ´»ç”¨ã—ã¦ Push é€šçŸ¥ã‚’é€ã‚‹"
emoji: "ğŸ‘‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Azure", "Xamarin", "é€šçŸ¥", "csharp", "Android"]
published: false
---

# ã¯ã˜ã‚ã«

ä»¥ä¸‹ã®ã‚‚ã®ã‚’æº–å‚™
- Visual Studio 2022
- Azure ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ ãŠã‚ˆã³ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆä»Šå›ä½¿ç”¨ã™ã‚‹ã®ã¯ç„¡æ–™Tierï¼‰
- Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

iOSã¯é–‹ç™ºè€…ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¸ã®ç™»éŒ²ãŒå¿…è¦ãã†ã ã£ãŸã‚Šã€ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ã®é€šçŸ¥é…ä¿¡ãŒæ€ªã—ã„ã‚‰ã—ã„ã®ã§ã€ã¨ã‚Šã‚ãˆãšAndroidã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§é€²ã‚ã‚‹ã“ã¨ã«ã—ãŸ

# å…¨ä½“åƒ
Xamarin.Androidã«å¯¾ã—ã¦pushé€šçŸ¥ã‚’é€ã‚‹å ´åˆã¯ã€[ã“ã¡ã‚‰](https://docs.microsoft.com/ja-jp/azure/developer/mobile-apps/notification-hubs-backend-service-xamarin-forms)ã®å…¬å¼docãŒã‚¬ã‚¤ãƒ‰ã—ã¦ãã‚Œãã†ã€‚ãŸã ã€ä»Šå›ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãªã—ã®ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆã«ã—ãŸã‹ã£ãŸã®ã§ã€ä»¥ä¸‹ã®é€šã‚Šã€Azure Portalã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨è¦‹ç«‹ã¦ã¦ã‚¿ã‚°åˆ¶å¾¡ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆé…ä¿¡ã‚’è¡Œã£ãŸã€‚
![overview.png](/images/cbef4b3929b33d/overview.png "å…¨ä½“åƒ")

æ„å¤–ã¨å‚è€ƒæ–‡çŒ®ãŒå°‘ãªã„ã‚‚ã®ã§ã€ä»¥ä¸‹ã®æ–¹ã€…ã®è¨˜äº‹ã‚‚å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã€‚
https://shuhelohelo.hatenablog.com/entry/2020/05/23/230302
https://qiita.com/usomaru/items/2f89b34c4d23be3b13fc#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB

# å®Ÿè£…
1. VSã§Xamarin.Formsã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. FCMã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
3. Azure Notification Hubs ãƒ‡ãƒ—ãƒ­ã‚¤ & è¨­å®š
4. Xamarin.Forms (Xamarin.Android) ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚’å®Ÿè£…

## 1. VSã§Xamarin.Formsã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2ã®ã‚¹ãƒ†ãƒƒãƒ—ã§FCMãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç«‹ã¦ã‚‹éš›ã«ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åãŒå¿…è¦ã¨ãªã‚‹ã®ã§ã€ã¨ã‚Šã‚ãˆãšã€Xamarin.Formsã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ã€‚ä½œæˆã‚’ã—çµ‚ãˆãŸã‚‰ã€Xamarin.Androidãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ>Properties>AndroidManifest.xmlã®ä¸­ã«è¨˜è¿°ã—ã¦ã‚ã‚‹ä»¥ä¸‹ã®è¡Œã‹ã‚‰ã€packageåã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã€‚
```
<manifest xmlns:android="http://schemas.android.com/apk/res/android" android:versionCode="1" android:versionName="1.0" package="com.companyname.pushdemoandroid">
```

## 2. FCMã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

1ã§ãƒ¡ãƒ¢ã—ãŸpackageåã‚’ä½¿ã£ã¦ã€[ã“ã¡ã‚‰](https://docs.microsoft.com/ja-jp/azure/notification-hubs/xamarin-notification-hubs-push-notifications-android-gcm#create-a-firebase-project-and-enable-firebase-cloud-messaging) ã®å…¬å¼docã‚’å‚è€ƒã«FCMãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚ãã®éš›ã€ä»¥ä¸‹ã®2ç‚¹ã«æ³¨æ„ã—ã¦ãŠãã€‚
- google-services.json ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
- FCMã®ã‚µãƒ¼ãƒã‚­ãƒ¼ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠã

## 3. Azure Notification Hubs ãƒ‡ãƒ—ãƒ­ã‚¤ & è¨­å®š
[ã“ã¡ã‚‰](https://docs.microsoft.com/ja-jp/azure/notification-hubs/xamarin-notification-hubs-push-notifications-android-gcm#create-a-notification-hub)ã®å…¬å¼docã«æ²¿ã£ã¦ã€Azure Notification Hubã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ãŒçµ‚ã‚ã£ãŸã‚‰ã€
ä»¥ä¸‹ã®3ç‚¹ã«æ³¨æ„ã—ã¦ãŠãã€‚
- Azure Notification Hubs ã®åå‰ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠã
- Auzre Notification Hubs ã®"ç®¡ç†"ï¼ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ï¼DefaultListenSharedAccessSignatureã‚’ãƒ¡ãƒ¢ã—ã¦ãŠã
- åå‰ç©ºé–“ã®"ç®¡ç†"ï¼ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ï¼RootManageSharedAccessKeyã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãï¼ˆçœç•¥å¯; Service Bus Explorerã§ç™»éŒ²ãƒ‡ãƒã‚¤ã‚¹ã‚’é–²è¦§ã—ãŸã„å ´åˆï¼‰

## 4. Xamarin.Forms (Xamarin.Android) ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚’å®Ÿè£…
ä»Šå›ã€VSä¸Šã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚’å®Ÿè£…ã—ã¦ã„ãã‚ã‘ã ãŒã€è¿½åŠ ãŠã‚ˆã³ç·¨é›†ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚
* è¿½åŠ 
  - NuGet package
  - google-service.json
  - Constants.cs 
* ç·¨é›†
  - AndroidManifest.xml
  - MainActivitiy.cs

### NuGet ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Android ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Manage NuGet Package ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚
- Xamarin.Azure.NotificationHubs.Androidï¼ˆver 1.1.4.1ï¼‰
- Xamarin.Firebase.Messagingï¼ˆver. 122.0.0ï¼‰
- Xamarin.GooglePlayServices.Baseï¼ˆver. 117.6.0ï¼‰
- Xamarin.Google.Daggerï¼ˆver. 2.39.1ï¼‰
  - https://stackoverflow.com/questions/65381403/java-lang-noclassdeffounderror-when-implementing-firebase-cloud-messaging


â€» .NET 6 ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å¯¾è±¡ã«ã—ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã®ã§ã€å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯ã€.NET 6ã‚ˆã‚Šã‚‚å‰ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’å¯¾è±¡ã¨ã—ã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã€‚

### google-service.json ã®è¿½åŠ 
Android ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Add>Existing Itemã‚’é¸æŠã€‚google-service.jsonã‚’è¿½åŠ ã™ã‚‹ã€‚è¿½åŠ ã•ã‚ŒãŸgoogle-service.jsonã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Build Actionã‚’GoogleServicesJsonã‚’é¸æŠã—ã¦ãŠãã€‚ã“ã®æ™‚ã€é¸æŠè‚¢ã«ç¾ã‚Œãªã‹ã£ãŸå ´åˆã¯ã€ä¸€æ—¦ã€VSã‚’å†èµ·å‹•ã—ã¦ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ã¿ã‚‹ã¨ã‚ˆã„ã€‚

![google-service.png](/images/cbef4b3929b33d/google-service.png "å…¨ä½“åƒ")

### AndroidManifest.xml ã‚’ç·¨é›†
AndroidManifest.xmlã‚’ç·¨é›†ã—ã¦ã€å„ç¨®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã€‚
```
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android" android:versionCode="1" android:versionName="1.0" package="com.companyname.pushdemoandroid">
    <uses-sdk android:minSdkVersion="21" android:targetSdkVersion="31" />

	//ã€€ã“ã“ã‹ã‚‰è¿½åŠ 
	<uses-permission android:name="android.permission.INTERNET" />
	<uses-permission android:name="com.google.android.c2dm.permission.RECEIVE" />
	<uses-permission android:name="android.permission.WAKE_LOCK" />
	<uses-permission android:name="android.permission.GET_ACCOUNTS" />
	// ã“ã“ã¾ã§è¿½åŠ 

	<application android:label="PushDemoAndroid.Android" android:theme="@style/MainTheme"></application>
    
	<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
</manifest>
```

### Constants.cs ã‚’ä½œæˆ
Androidãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€csã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã€‚ä»¥ä¸‹ã«ç¤ºã™é€šã‚Šã€ã‚¹ãƒ†ãƒƒãƒ—3ã§ãƒ¡ãƒ¢ã—ãŸAzure Notificaiton Hubsã®åå‰ã¨DefaultListenSharedAccessSignatureã‚’å®£è¨€ã™ã‚‹ã€‚
```
namespace PushDemoAndroid.Droid
{
    public static class Constants
    {
        public const string ListenConnectionString = "<DefaultListenSharedAccessSignatureã‚’ã“ã“ã«ãƒšãƒ¼ã‚¹ãƒˆ>";
        public const string NotificationHubName = "<Azure Notificaiton Hubsã®åå‰ã‚’ã“ã“ã«ãƒšãƒ¼ã‚¹ãƒˆ>";
    }
}
```

### MainActivity.cs ã‚’ç·¨é›†
MainActivity.csã‚’é–‹ãã€ä»¥ä¸‹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚
```
using Android.App;
using Android.Content.PM;
using Android.Runtime;
using Android.OS;
using Android.Util;
using Android.Gms.Common;
```

ã‚¯ãƒ©ã‚¹å†…ã«ä»¥ä¸‹ã‚’è¿½åŠ ã€‚

```
public const string TAG = "MainActivity";
internal static readonly string CHANNEL_ID = "my_notification_channel";
```

Google Play Service ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã€‚

```
public bool IsPlayServicesAvailable()
{
    int resultCode = GoogleApiAvailability.Instance.IsGooglePlayServicesAvailable(this);
    if (resultCode != ConnectionResult.Success)
    {
        if (GoogleApiAvailability.Instance.IsUserResolvableError(resultCode))
            Log.Debug(TAG, GoogleApiAvailability.Instance.GetErrorString(resultCode));
        else
        {
            Log.Debug(TAG, "This device is not supported");
            Finish();
        }
        return false;
    }

    Log.Debug(TAG, "Google Play Services is available.");
    return true;
}
```

Notification Channel ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã€‚

```
private void CreateNotificationChannel()
{
    if (Build.VERSION.SdkInt < BuildVersionCodes.O)
    {
        // Notification channels are new in API 26 (and not a part of the
        // support library). There is no need to create a notification
        // channel on older versions of Android.
        return;
    }

    var channelName = CHANNEL_ID;
    var channelDescription = string.Empty;
    // edit NotificationImportance.Default to High for enabling pop-up notification
    var channel = new NotificationChannel(CHANNEL_ID, channelName, NotificationImportance.High) 
    {
        Description = channelDescription
    };

    var notificationManager = (NotificationManager)GetSystemService(NotificationService);
    notificationManager.CreateNotificationChannel(channel);
}
```

ä¸Šã®ï¼’ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ãŸã‚ã«ã€OnCreateãƒ¡ã‚½ãƒƒãƒ‰å†…ã® `base.OnCreate(savedInstanceState);` ã®å¾Œã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã€‚

```
if (Intent.Extras != null)
{
    foreach (var key in Intent.Extras.KeySet())
    {
        if (key != null)
        {
            var value = Intent.Extras.GetString(key);
            Log.Debug(TAG, "Key: {0} Value: {1}", key, value);
        }
    }
}

IsPlayServicesAvailable();
CreateNotificationChannel();
```



### MyFirebaseMessagingService.cs ã‚’ä½œæˆ
Androidãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€csã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã€‚ä»¥ä¸‹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚
```
using Android.App;
using Android.Content;
using System;
using System.Collections.Generic;
using System.Linq;
using Android.Util;
using Firebase.Messaging;
using WindowsAzure.Messaging;
using AndroidX.Core.App;
```

MyFirebaseMessagingServiceã‚¯ãƒ©ã‚¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®£è¨€ã™ã‚‹ã€‚

```
namespace PushDemoAndroid.Droid
{
    [Service]
    [IntentFilter(new[] { "com.google.firebase.MESSAGING_EVENT" })]
    [IntentFilter(new[] { "com.google.firebase.INSTANCE_ID_EVENT" })]
    public class MyFirebaseMessagingService : FirebaseMessagingService
    {
        ...
    }
}
```

ã‚¯ãƒ©ã‚¹å†…ã«ä»¥ä¸‹ã‚’è¿½åŠ ã€‚

```
const string TAG = "MyFirebaseMsgService";
NotificationHub hub;
```

Pushé€šçŸ¥ã‚’å—ã‘å–ã‚‹ã¨å‘¼ã³å‡ºã•ã‚Œã‚‹OnMessageReceivedãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¿½åŠ ã€‚

```
public override void OnMessageReceived(RemoteMessage message)
{
    Log.Debug(TAG, "From: " + message.From);
    if (message.GetNotification() != null)
    {
        //These is how most messages will be received
        Log.Debug(TAG, "Notification Message Body: " + message.GetNotification().Body);
        SendNotification(message.GetNotification().Body);
    }
    else
    {
        //Only used for debugging payloads sent from the Azure portal
        SendNotification(message.Data.Values.First());

    }
}
```

OnMessageReceivedãƒ¡ã‚½ãƒƒãƒ‰å†…ã§å‘¼ã°ã‚Œã¦ã„ã‚‹SendNotificationãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«é€šçŸ¥ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã€‚`.SetContentTitle()` ã‚’ç·¨é›†ã™ã‚‹ã“ã¨ã§ã€é€šçŸ¥ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```
void SendNotification(string messageBody)
{
    var intent = new Intent(this, typeof(MainActivity));
    intent.AddFlags(ActivityFlags.ClearTop);
    var pendingIntent = PendingIntent.GetActivity(this, 0, intent, PendingIntentFlags.OneShot);

    var notificationBuilder = new NotificationCompat.Builder(this, MainActivity.CHANNEL_ID);

    // edit Content Title for notification title
    notificationBuilder.SetContentTitle("Push Demo Android")
                .SetSmallIcon(Resource.Drawable.ic_launcher)
                .SetContentText(messageBody)
                .SetAutoCancel(true)
                .SetShowWhen(false)
                .SetContentIntent(pendingIntent);

    var notificationManager = NotificationManager.FromContext(this);

    notificationManager.Notify(0, notificationBuilder.Build());
}
```

ã•ã‚‰ã«ã€Azure Notification Hubs ã«ãƒ‡ãƒã‚¤ã‚¹ã‚’ç™»éŒ²ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚

```
public override void OnNewToken(string token)
{
    Log.Debug(TAG, "FCM token: " + token);
    SendRegistrationToServer(token);
}

void SendRegistrationToServer(string token)
{
    // Register with Notification Hubs
    hub = new NotificationHub(Constants.NotificationHubName,
                                Constants.ListenConnectionString, this);

    var dt = DateTime.Now;
    var timeTag = dt.ToString("HH:mm:ss");

    var carVendor = "";
    var vendorType = "";
    var vendorLocation = "";
    var carGrade = "";
    switch (Convert.ToInt64(dt.Minute) % 10) {
        case 0: case 1: case 2: case 3:
            carVendor = "TOYOTA";
            vendorType = "JapaneseCar";
            vendorLocation = "Aichi";
            carGrade = "20";
            break;
        case 4: case 5: case 6:
            carVendor = "NISSAN";
            vendorType = "JapaneseCar";
            vendorLocation = "Kanagawa";
            carGrade = "15";
            break;
        case 7: case 8: case 9:
            carVendor = "BMW";
            vendorType = "ForeignCar";
            vendorLocation = "Munich";
            carGrade = "10";
            break;
        default:
            carVendor = "tmp1";
            vendorType = "tmp2";
            vendorLocation = "tmp3";
            carGrade = "tmp4";
            break;
    }

    var tags = new List<string>() {timeTag, carVendor, vendorType, vendorLocation, carGrade};
    var regID = hub.Register(token, tags.ToArray()).RegistrationId;

    Log.Debug(TAG, $"Successful registration of ID {regID}");
}
```

`SendRegistrationToServer` ã«ã¦ã€ã‚¿ã‚°ã®è¨­å®šãªã©ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã€‚ç°¡å˜ã«èª¬æ˜ã™ã‚‹ã¨ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆtimeTagï¼‰ã€è‡ªå‹•è»Šãƒ¡ãƒ¼ã‚«åï¼ˆcarVendorï¼‰ã€å›½ç”£è»Šã‹å¤–è»Šã‹ï¼ˆvendorTypeï¼‰ã€ãƒ¡ãƒ¼ã‚«ã®æ‰€åœ¨åœ°ï¼ˆvendorLocationï¼‰ã€ç­‰ç´šï¼ˆcarGradeï¼‰ã¨ã„ã†ã‚¿ã‚°ç¾¤ã‚’ãƒªã‚¹ãƒˆã«æ ¼ç´ã—ã¦ã€`hub.Register()` ã«ã¦ã€ç™»éŒ²ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚

ã‚¿ã‚°è‡ªä½“ã¯ã€ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«å–å¾—ã—ãŸã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆåˆ†ï¼‰ã‚’å…ƒã«è¡Œã£ã¦ãŠã‚Šã€åˆ†ã®1æ¡ç›®ãŒ0~3ã§ã‚ã‚Œã°ã€1ã¤ç›®ã®caseåˆ†å²ã€4~6ã§ã‚ã‚Œã°ã€2ã¤ç›®ã®caseåˆ†å²ã€7~9ã§ã‚ã‚Œã°ã€3ã¤ç›®ã®caseåˆ†å²ã«å…¥ã£ã¦ã€ã‚¿ã‚°ãŒå¤‰æ•°è¨­å®šã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚

# é…ä¿¡
VSã§ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã‚’è¡Œã†ã€‚ä»Šå›ã¯ã€Pixel 5ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ãŸã€‚ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã™ã‚‹ã¾ã§å¾…ã¤ã€‚

## Service Bus Explorer ã«ã‚ˆã‚‹ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²ã®ç¢ºèªï¼ˆçœç•¥å¯ï¼‰
ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã™ã‚‹ã¨ã€ãƒ‡ãƒã‚¤ã‚¹ãŒç™»éŒ²ã•ã‚Œã‚‹ãŒã€ä»Šå›ã¯ã€Service Bus Explorerã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã€è¦—ã„ã¦ã¿ã‚‹ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ã€‚ç§ã¯ã€chocolateyçµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã£ãŸã€‚
https://github.com/paolosalvatori/ServiceBusExplorer

ã‚¹ãƒ†ãƒƒãƒ—3ã§ãƒ¡ãƒ¢ã—ãŸåå‰ç©ºé–“ã®æ–¹ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ç”¨ã„ã¦ã€ã“ã¡ã‚‰ã® Microsoft Japan PaaS ãƒãƒ¼ãƒ ã®ãƒ–ãƒ­ã‚°ã«æ²¿ã£ã¦ã€ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ã®ç¢ºèªã‚’ã™ã‚‹ã€‚
https://jpazpaas.github.io/blog/2021/08/27/howto-get-registrations.html

## ãƒ†ã‚¹ãƒˆé…ä¿¡
Azure Portal ã‹ã‚‰ Notification Hubs ã‚’é–‹ãã€ãƒ†ã‚¹ãƒˆé…ä¿¡ã®ãƒšã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¯Androidã‚’é¸æŠã—ã€ä»¥ä¸‹ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’é€ä¿¡ã™ã‚‹ã€‚

```
{
	"data":{
		"property1":"PUSH TEST !!",
		"property2":42
	}
}
```

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã€ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãŠã‚ˆã³ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã®ã©ã¡ã‚‰ã§ã‚‚ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãŒå±Šãã“ã¨ãŒç¢ºèªå‡ºæ¥ãŸã‚‰æˆåŠŸã§ã‚ã‚‹ã€‚

â€» Pushé€šçŸ¥ã‚’å—ã‘å–ã‚Œã‚‹ã‚‚ã®ã®ã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€MainActivity.cs > `CreateNotificationChannel()` ã® `var channel = new NotificationChannel(CHANNEL_ID, channelName, NotificationImportance.High)` ã«ã¦ã€`NotificationImportance.Default` ã§ã¯ãªã `NotificationImportance.High` ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

â€» ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã« notificaion ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’çœç•¥ã—ãŸç†ç”±ã«ã¤ã„ã¦ã¯ã€[FCMã®å…¬å¼doc](https://firebase.google.com/docs/cloud-messaging/android/receive) ã‚’å‚ç…§ã€‚ã¡ãªã¿ã«ã€ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã¯ã€ã‚¢ãƒ—ãƒªå´ã¨ã‚·ã‚¹ãƒ†ãƒ ãƒˆãƒ¬ã‚¤å´ã§å‡¦ç†éƒ¨ãŒç•°ãªã‚‹ã®ã§æ³¨æ„ã™ã‚‹ã€‚

## ã‚¿ã‚°ã‚’æ´»ç”¨ã—ãŸè¤‡æ•°ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ã®ãƒ†ã‚¹ãƒˆé…ä¿¡
VSã‚’Debugã‹ã‚‰Releaseã«å¤‰æ›´ã—ã¦ã€Build>Archiveã‹ã‚‰apkãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹ã€‚ãã®å¾Œã€App Centreã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šã’ã¦ã‚¢ãƒ—ãƒªã®é…ä¿¡ã‚’è¡Œã†ã€‚Android ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’è¤‡æ•°èµ·å‹•ã—ã€ãã‚Œãã‚Œã«ã‚¢ãƒ—ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€å‰è¿°ã¾ã§ã®æµã‚Œã¨åŒã˜ã‚ˆã†ã«Pushé€šçŸ¥ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

â€» apkãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹éš›ã«ã€ç½²åã‚’ã¤ã‘ãªã‘ã‚Œã°ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«éš›ã«ãƒ‘ãƒ¼ã‚¹ã§ããªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚ï¼ˆå®Ÿéš›ã€ç§ã®æ‰‹å…ƒã§ã¯ç™ºç”Ÿã—ãŸï¼‰

ã‚¿ã‚°ã®æŒ‡å®šã‚„ã‚¿ã‚°å¼ã®æ´»ç”¨ã«ã¤ã„ã¦ã¯ã€ãƒ‡ãƒ¢å‹•ç”»ã‚’YouTubeã«ä¸Šã’ãŸã®ã§ã€ã“ã¡ã‚‰ã§ç¢ºèªã•ã‚ŒãŸã„ã€‚Notification HubsãŒé€šçŸ¥ã®å…±é€šãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ã—ã¦å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã‹ã¨æ€ã†ã€‚
https://youtu.be/G1IVukLznks


ã¡ãªã¿ã«ã€ä¸Šã®ãƒ‡ãƒ¢å‹•ç”»ã¯ã€æœ€è¿‘ã€Microsoft ãŒè²·åã—ãŸ Clipchamp ã¨ã„ã†å‹•ç”»ç·¨é›†ã‚½ãƒ•ãƒˆã§1~2æ™‚é–“ç¨‹ã§ä½œæˆã—ãŸã®ã€ã“ã¡ã‚‰ã‚‚ã”èˆˆå‘³ã‚ã‚Œã°è§¦ã£ã¦ã¿ã‚‹ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚

[Clipchampï¼šMicrosoftã€ç„¡å„Ÿã§å§‹ã‚ã‚‰ã‚Œã‚‹ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å‹•ç”»ç·¨é›†ãƒ„ãƒ¼ãƒ«ã€ŒClipchampã€ã‚’ç™ºè¡¨](https://forest.watch.impress.co.jp/docs/news/1364904.html) 
